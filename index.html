<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>عقد إيجار منتجع</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root{ --brand-blue:#2980b9; }
*{ box-sizing:border-box; }
body{
  font-family:'Times New Roman', Arial, Tahoma, sans-serif;
  direction:rtl; margin:0; padding:0;
  background:#fdf5e6; text-align:right;
}
.container{
  max-width:800px; margin:16px auto; padding:20px;
  background:#fff; border-radius:14px;
  border:3px solid var(--brand-blue)!important;
  box-shadow:0 0 0 3px var(--brand-blue) inset!important;
  box-sizing:border-box;
}
h1{
  text-align:center; color:#2c3e50; font-size:26px; margin:8px 0 6px;
}
.title-underline{
  width:140px; height:3px; background:var(--brand-blue);
  margin:6px auto 12px; border-radius:2px;
}
.booking-number{
  color:#e53935; font-weight:bold; font-size:22px;
  text-align:center; margin:10px 0 16px;
}
.booking-info p, .terms ul{
  font-size:16px; line-height:1.6; margin:0;
}
.info-row{ margin:6px 0; }
hr{ border:2px solid var(--brand-blue); margin:18px 0; }
.terms h3{ margin:0 0 8px; color:#2c3e50; }
.terms ul{ list-style:none; padding:0; margin:0; }
.terms li{ margin:6px 0; }
.terms li .dash{ color:var(--brand-blue); font-weight:bold; margin-left:6px; }
.contract-footer{
  text-align:center; font-size:12px; color:#555; margin-top:18px;
}
.footer-note{ margin-top:6px; color:#2c3e50; }

form{
  max-width:520px; margin:18px auto; background:#fff;
  padding:16px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,.07);
}
label{ display:block; margin-top:12px; font-weight:bold; color:#2c3e50; }
input, select{
  width:100%; padding:10px; margin-top:6px; border-radius:8px;
  border:1px solid #cfcfcf; font-family:'Times New Roman', Arial, Tahoma, sans-serif;
}
button[type="submit"]{
  margin-top:16px; padding:12px 18px; background:#27ae60; color:#fff;
  border:none; border-radius:10px; cursor:pointer; font-size:16px; width:100%;
}
.actions{
  display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:10px;
}
.btn{
  background:var(--brand-blue); color:#fff; border:none;
  padding:12px 16px; font-size:15px; border-radius:10px; cursor:pointer; min-width:180px;
}
</style>
</head>
<body>

<form id="bookingForm">
  <label>اختر المنتجع:</label>
  <select id="resortSelect" required>
    <option value="" disabled selected>اختر المنتجع</option>
    <option value="منتجع تامبا">منتجع تامبا</option>
    <option value="منتجع فيولاراند">منتجع فيولاراند</option>
  </select>

  <label>اسم المستأجر:</label>
  <input type="text" id="customerName" required>

  <label>العربون (ريال):</label>
  <input type="number" id="deposit" min="0" required>

  <label>المتبقي (ريال):</label>
  <input type="number" id="remaining" min="0" required>

  <label>تاريخ الحجز:</label>
  <input type="date" id="bookingDate" required>

  <button type="submit">عرض العقد</button>
</form>

<div id="contract" class="container" style="display:none;">
  <h1 id="contractTitle"></h1>
  <div class="title-underline"></div>
  <div id="bookingNumber" class="booking-number"></div>

  <div class="booking-info" id="bookingInfo">
    <p id="infoText"></p>
  </div>

  <hr>

  <div class="terms">
    <h3>الشروط:</h3>
    <ul>
      <li><span class="dash">—</span> العربون غير مسترد</li>
      <li><span class="dash">—</span> المنتجع غير مسؤول عن فقدان الأغراض الشخصية</li>
      <li><span class="dash">—</span> في حال الأضرار المادية يتحمل المستأجر كافة التكاليف</li>
      <li><span class="dash">—</span> يمنع التدخين منعا باتا داخل غرف وصالات المنتجع 🚭</li>
      <li><span class="dash">—</span> يجب إبلاغ الحارس وقت الخروج لإخلاء مسؤولية المستأجر وفحص واستلام المنتجع</li>
      <li><span class="dash">—</span> الالتزام بأوقات الدخول والخروج المحددة</li>
    </ul>
    <p><strong>الرجاء الرد بكلمة موافق</strong></p>
  </div>

  <div class="contract-footer" id="contractFooter"></div>

  <div class="actions">
    <button id="printBtn" class="btn">حفظ كـ PDF</button>
    <button id="saveImageBtn" class="btn">حفظ كصورة للواتس</button>
    <button id="calendarBtn" class="btn">أضف إلى Google Calendar</button>
    <button id="calendarICSBtn" class="btn">تحميل ملف التقويم (.ics)</button>
  </div>
</div>

<script>
const form=document.getElementById('bookingForm');
const contract=document.getElementById('contract');
const infoText=document.getElementById('infoText');
const printBtn=document.getElementById('printBtn');
const saveImageBtn=document.getElementById('saveImageBtn');
const calendarBtn=document.getElementById('calendarBtn');
const calendarICSBtn=document.getElementById('calendarICSBtn');
const contractFooter=document.getElementById('contractFooter');
const contractTitle=document.getElementById('contractTitle');
const bookingNumberEl=document.getElementById('bookingNumber');

function getDayName(d){return ["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"][new Date(d).getDay()];}
function todayStr(){let t=new Date();return `${String(t.getDate()).padStart(2,'0')}-${String(t.getMonth()+1).padStart(2,'0')}-${t.getFullYear()}`;}

form.addEventListener('submit',e=>{
 e.preventDefault();
 const resort=document.getElementById('resortSelect').value;
 const name=document.getElementById('customerName').value;
 const dep=document.getElementById('deposit').value;
 const rem=document.getElementById('remaining').value;
 const date=document.getElementById('bookingDate').value;
 contractTitle.textContent=`عقد إيجار ${resort}`;
 bookingNumberEl.textContent=`رقم الحجز: ${resort==='منتجع تامبا'?'0117':'201'}`;
 infoText.innerHTML=`
   <b>اسم المستأجر:</b> ${name}<br>
   <b>العربون:</b> ${dep} ريال<br>
   <b>المتبقي:</b> ${rem} ريال<br><br>
   <b>تاريخ ويوم الحجز:</b> ${getDayName(date)} ${date}<br><br>
   <b>ساعات الحجز:</b> من ٣ مساءً إلى ٦ صباحًا`;
 contractFooter.innerHTML=`تاريخ العقد: ${todayStr()}<div class="footer-note">تم إعداد هذا العقد إلكترونيًا — ${(resort==='منتجع تامبا')?'منتجع تامبا':'منتجع فيولاراند'}</div>`;
 contract.style.display='block';
 window.scrollTo({top:contract.offsetTop,behavior:'smooth'});

 // PDF
 printBtn.onclick=function(){
   document.querySelector('.actions').style.display='none';
   form.style.display='none';
   const fileName=name.trim().replace(/\s+/g,'_')+'.pdf';
   html2pdf().from(contract).set({
     margin:10,
     filename:fileName,
     html2canvas:{scale:2,useCORS:true},
     jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
   }).save().then(()=>{
     document.querySelector('.actions').style.display='flex';
     form.style.display='block';
   });
 };

 // صورة
 saveImageBtn.onclick=function(){
   document.querySelector('.actions').style.display='none';
   html2canvas(contract).then(canvas=>{
     canvas.toBlob(function(blob){
       const a=document.createElement('a');
       a.download=name.trim().replace(/\s+/g,'_')+'.png';
       a.href=URL.createObjectURL(blob);
       document.body.appendChild(a);a.click();document.body.removeChild(a);
       document.querySelector('.actions').style.display='flex';
     },'image/png');
   });
 };

 // Google Calendar
 calendarBtn.onclick=function(){
   const first=name.split(' ')[0];
   const desc=`العربون: ${dep} ريال\nالمتبقي: ${rem} ريال`;
   const start=date.replace(/-/g,'')+'T150000Z';
   const end=date.replace(/-/g,'')+'T060000Z';
   const url=`https://calendar.google.com/calendar/r/eventedit?text=حجز+${encodeURIComponent(first)}&dates=${start}/${end}&details=${encodeURIComponent(desc)}`;
   window.open(url,'_blank');
 };

 // ملف ICS
 calendarICSBtn.onclick=function(){
   const first=name.split(' ')[0];
   const start=date.replace(/-/g,'')+'T150000';
   const end=date.replace(/-/g,'')+'T060000';
   const ics=`BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:حجز ${first}
DESCRIPTION:العربون: ${dep} ريال\\nالمتبقي: ${rem} ريال
DTSTART:${start}
DTEND:${end}
END:VEVENT
END:VCALENDAR`.trim();
   const blob=new Blob([ics],{type:'text/calendar'});
   const a=document.createElement('a');
   a.href=URL.createObjectURL(blob);
   a.download=name.trim().replace(/\s+/g,'_')+'.ics';
   document.body.appendChild(a);a.click();document.body.removeChild(a);
 };
});
</script>

</body>
</html>
