<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>عقد إيجار منتجع تامبا</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
    body {
        font-family: 'Times New Roman', Times, serif;
        direction: rtl;
        margin: 0;
        padding: 0;
        background-color: #fdf5e6; /* فاتح مائل للسكري */
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    .container {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 12px;
        box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }
    h1 {
        text-align: center;
        color: #2c3e50;
        font-size: 28px;
        margin-bottom: 20px;
    }
    .booking-info p, .terms ul {
        font-size: 16px;
        line-height: 1.6;
    }
    .terms {
        margin-top: 20px;
    }
    .terms h3 {
        margin-bottom: 10px;
    }
    .terms ul {
        list-style-type: none; /* شيل النقط */
        padding-left: 0;
    }
    .bold {
        font-weight: bold;
    }
    .booking-number {
        color: red;
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 10px;
        display: block;
    }
    .contract-footer {
        text-align: center;
        font-size: 12px;
        color: #555;
        margin-top: 25px;
    }
    #printBtn, #calendarBtn, #calendarICSBtn {
        background-color: #2980b9;
        color: #fff;
        border: none;
        padding: 12px 20px;
        font-size: 16px;
        border-radius: 6px;
        cursor: pointer;
        display: block;
        margin: 10px auto;
    }
    form {
        max-width: 500px;
        margin: 20px auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    label {
        display: block;
        margin-top: 15px;
        font-weight: bold;
    }
    input[type="text"], input[type="number"], input[type="date"] {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
        box-sizing: border-box;
        font-family: 'Times New Roman', Times, serif;
    }
    button[type="submit"] {
        margin-top: 20px;
        padding: 12px 20px;
        background-color: #27ae60;
        color: #fff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        width: 100%;
    }
</style>
</head>
<body>

<form id="bookingForm">
    <label>اسم المستأجر:</label>
    <input type="text" id="customerName" required>

    <label>العربون (ريال):</label>
    <input type="number" id="deposit" min="0" required>

    <label>المتبقي (ريال):</label>
    <input type="number" id="remaining" min="0" required>

    <label>تاريخ الحجز:</label>
    <input type="date" id="bookingDate" required>

    <button type="submit">عرض العقد</button>
</form>

<div id="contract" class="container" style="display:none;">
    <h1>عقد إيجار منتجع تامبا</h1>

    <div class="booking-info" id="bookingInfo">
        <p id="infoText"></p>
    </div>

    <div class="terms" id="terms">
        <h3>الشروط:</h3>
        <ul>
            <li>الدخول الساعة ٣ مساء / الخروج الساعة ٦ صباحًا</li>
            <li>العربون غير مسترد</li>
            <li>المنتجع غير مسؤول عن فقدان الأغراض الشخصية</li>
            <li>في حال الأضرار المادية يتحمل المستأجر كافة التكاليف</li>
            <li>يمنع التدخين منعا باتا داخل غرف وصالات المنتجع 🚭</li>
            <li>يجب إبلاغ الحارس وقت الخروج لإخلاء مسؤولية المستأجر وفحص واستلام المنتجع</li>
        </ul>
        <p><strong>الرجاء الرد بكلمة موافق</strong></p>
    </div>

    <div class="contract-footer" id="contractFooter"></div>

    <button id="printBtn">طباعة / حفظ كصورة</button>
    <button id="calendarBtn">أضف إلى Google Calendar (كمبيوتر)</button>
    <button id="calendarICSBtn">تحميل ملف التقويم (.ics)</button>
</div>

<script>
const form = document.getElementById('bookingForm');
const contract = document.getElementById('contract');
const infoText = document.getElementById('infoText');
const printBtn = document.getElementById('printBtn');
const calendarBtn = document.getElementById('calendarBtn');
const calendarICSBtn = document.getElementById('calendarICSBtn');
const contractFooter = document.getElementById('contractFooter');

function getDayName(dateStr) {
    const days = ["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"];
    const date = new Date(dateStr);
    return days[date.getDay()];
}

function formatToday() {
    const today = new Date();
    const day = String(today.getDate()).padStart(2,'0');
    const month = String(today.getMonth()+1).padStart(2,'0');
    const year = today.getFullYear();
    return `${day}-${month}-${year}`;
}

function addToGoogleCalendar(customerName, deposit, remaining, bookingDate) {
    const firstName = customerName.split(' ')[0];
    const description = `العربون: ${deposit} ريال\nالمتبقي: ${remaining} ريال`;
    const startDate = bookingDate.replace(/-/g, '') + 'T150000Z';
    const endDate = bookingDate.replace(/-/g, '') + 'T060000Z';
    const url = `https://calendar.google.com/calendar/r/eventedit?text=حجز+${encodeURIComponent(firstName)}&dates=${startDate}/${endDate}&details=${encodeURIComponent(description)}`;
    window.open(url, '_blank');
}

function downloadICS(customerName, deposit, remaining, bookingDate) {
    const firstName = customerName.split(' ')[0];
    const startDate = bookingDate.replace(/-/g, '') + 'T150000';
    const endDate = bookingDate.replace(/-/g, '') + 'T060000';
    const icsContent = `
BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:حجز ${firstName}
DESCRIPTION:العربون: ${deposit} ريال\\nالمتبقي: ${remaining} ريال
DTSTART:${startDate}
DTEND:${endDate}
END:VEVENT
END:VCALENDAR
    `.trim();

    const blob = new Blob([icsContent], { type: 'text/calendar' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = customerName.trim().replace(/\s+/g, '_') + '.ics';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

form.addEventListener('submit', function(e){
    e.preventDefault();

    const customerName = document.getElementById('customerName').value;
    const deposit = document.getElementById('deposit').value;
    const remaining = document.getElementById('remaining').value;
    const bookingDate = document.getElementById('bookingDate').value;

    const dayName = getDayName(bookingDate);

    infoText.innerHTML = `
        <span class="booking-number">رقم الحجز: 117</span>
        <span class="bold">اسم المستأجر:</span> <span class="bold">${customerName}</span> <br>
        <strong>العربون:</strong> ${deposit} ريال <br>
        <span class="bold">المتبقي:</span> <span class="bold">${remaining} ريال</span> <br>
        <strong>تاريخ الحجز:</strong> ${dayName} ${bookingDate} <br>
        <strong>ساعات الحجز:</strong> الدخول ٣ مساء / الخروج ٦ صباحًا
    `;

    const todayStr = formatToday();
    contractFooter.innerHTML = `تاريخ العقد: ${todayStr}`;

    contract.style.display = 'block';
    window.scrollTo({ top: contract.offsetTop, behavior: 'smooth' });

    // Google Calendar للكمبيوتر
    calendarBtn.onclick = function() {
        addToGoogleCalendar(customerName, deposit, remaining, bookingDate);
    }

    // حفظ الصورة باسم المستأجر بدون الأزرار
    printBtn.onclick = function() {
        printBtn.style.display = 'none';
        calendarBtn.style.display = 'none';
        calendarICSBtn.style.display = 'none';

        html2canvas(contract, {scale:2}).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const newTab = window.open();
            newTab.document.write(`<img src="${imgData}" style="width:100%">`);
            printBtn.style.display = 'block';
            calendarBtn.style.display = 'block';
            calendarICSBtn.style.display = 'block';
        });
    }

    // تحميل ملف .ics للجوال والكمبيوتر
    calendarICSBtn.onclick = function() {
        downloadICS(customerName, deposit, remaining, bookingDate);
    }
});
</script>

</body>
</html>
