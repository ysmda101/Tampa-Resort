<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¹Ù‚Ø¯ Ø¥ÙŠØ¬Ø§Ø± Ù…Ù†ØªØ¬Ø¹ ØªØ§Ù…Ø¨Ø§</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
body {
    font-family: Arial, Tahoma, sans-serif;
    direction: rtl;
    margin: 0;
    padding: 0;
    background-color: #fdf5e6; /* ÙØ§ØªØ­ Ù…Ø§Ø¦Ù„ Ù„Ù„Ø³ÙƒØ±ÙŠ */
    word-spacing: normal;
    letter-spacing: normal;
    text-align: right;
}
.container {
    max-width: 800px;
    margin: 20px auto;
    padding: 20px;
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 6px 12px rgba(0,0,0,0.1);
}
h1 {
    text-align: center;
    color: #2c3e50;
    font-size: 28px;
    margin-bottom: 20px;
}
.booking-info p, .terms ul {
    font-size: 16px;
    line-height: 1.5;
    word-break: normal;
}
.terms {
    margin-top: 20px;
}
.terms h3 {
    margin-bottom: 10px;
}
.terms ul {
    list-style-type: none;
    padding-left: 0;
}
.bold { font-weight: bold; }
.booking-number {
    color: red;
    font-weight: bold;
    font-size: 18px;
    margin-bottom: 10px;
    display: block;
}
.contract-footer {
    text-align: center;
    font-size: 12px;
    color: #555;
    margin-top: 25px;
}
#printBtn, #calendarBtn, #calendarICSBtn {
    background-color: #2980b9;
    color: #fff;
    border: none;
    padding: 12px 20px;
    font-size: 16px;
    border-radius: 6px;
    cursor: pointer;
    display: block;
    margin: 10px auto;
}
form {
    max-width: 500px;
    margin: 20px auto;
    background-color: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
label {
    display: block;
    margin-top: 15px;
    font-weight: bold;
}
input[type="text"], input[type="number"], input[type="date"] {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    border-radius: 5px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    font-family: Arial, Tahoma, sans-serif;
}
button[type="submit"] {
    margin-top: 20px;
    padding: 12px 20px;
    background-color: #27ae60;
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    width: 100%;
}
hr {
    border: 2px solid #2980b9;
    margin: 20px 0;
}
</style>
</head>
<body>

<form id="bookingForm">
    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±:</label>
    <input type="text" id="customerName" required>

    <label>Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ† (Ø±ÙŠØ§Ù„):</label>
    <input type="number" id="deposit" min="0" required>

    <label>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ (Ø±ÙŠØ§Ù„):</label>
    <input type="number" id="remaining" min="0" required>

    <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²:</label>
    <input type="date" id="bookingDate" required>

    <button type="submit">Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù‚Ø¯</button>
</form>

<div id="contract" class="container" style="display:none;">
    <h1>Ø¹Ù‚Ø¯ Ø¥ÙŠØ¬Ø§Ø± Ù…Ù†ØªØ¬Ø¹ ØªØ§Ù…Ø¨Ø§</h1>

    <div class="booking-info" id="bookingInfo">
        <p id="infoText"></p>
    </div>

    <hr>

    <div class="terms" id="terms">
        <h3>Ø§Ù„Ø´Ø±ÙˆØ·:</h3>
        <ul>
            <li>Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ† ØºÙŠØ± Ù…Ø³ØªØ±Ø¯</li>
            <li>Ø§Ù„Ù…Ù†ØªØ¬Ø¹ ØºÙŠØ± Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø´Ø®ØµÙŠØ©</li>
            <li>ÙÙŠ Ø­Ø§Ù„ Ø§Ù„Ø£Ø¶Ø±Ø§Ø± Ø§Ù„Ù…Ø§Ø¯ÙŠØ© ÙŠØªØ­Ù…Ù„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± ÙƒØ§ÙØ© Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ</li>
            <li>ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªØ¯Ø®ÙŠÙ† Ù…Ù†Ø¹Ø§ Ø¨Ø§ØªØ§ Ø¯Ø§Ø®Ù„ ØºØ±Ù ÙˆØµØ§Ù„Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø¹ ğŸš­</li>
            <li>ÙŠØ¬Ø¨ Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø­Ø§Ø±Ø³ ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬ Ù„Ø¥Ø®Ù„Ø§Ø¡ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± ÙˆÙØ­Øµ ÙˆØ§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø¹</li>
        </ul>
        <p><strong>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø±Ø¯ Ø¨ÙƒÙ„Ù…Ø© Ù…ÙˆØ§ÙÙ‚</strong></p>
    </div>

    <div class="contract-footer" id="contractFooter"></div>

    <button id="printBtn">Ø­ÙØ¸ ÙƒÙ€ PDF</button>
    <button id="calendarBtn">Ø£Ø¶Ù Ø¥Ù„Ù‰ Google Calendar (ÙƒÙ…Ø¨ÙŠÙˆØªØ±)</button>
    <button id="calendarICSBtn">ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„ØªÙ‚ÙˆÙŠÙ… (.ics)</button>
</div>

<script>
const form = document.getElementById('bookingForm');
const contract = document.getElementById('contract');
const infoText = document.getElementById('infoText');
const printBtn = document.getElementById('printBtn');
const calendarBtn = document.getElementById('calendarBtn');
const calendarICSBtn = document.getElementById('calendarICSBtn');
const contractFooter = document.getElementById('contractFooter');

function getDayName(dateStr) {
    const days = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];
    const date = new Date(dateStr);
    return days[date.getDay()];
}

function formatToday() {
    const today = new Date();
    const day = String(today.getDate()).padStart(2,'0');
    const month = String(today.getMonth()+1).padStart(2,'0');
    const year = today.getFullYear();
    return `${day}-${month}-${year}`;
}

function addToGoogleCalendar(customerName, deposit, remaining, bookingDate) {
    const firstName = customerName.split(' ')[0];
    const description = `Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†: ${deposit} Ø±ÙŠØ§Ù„\nØ§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remaining} Ø±ÙŠØ§Ù„`;
    const startDate = bookingDate.replace(/-/g, '') + 'T150000Z';
    const endDate = bookingDate.replace(/-/g, '') + 'T060000Z';
    const url = `https://calendar.google.com/calendar/r/eventedit?text=Ø­Ø¬Ø²+${encodeURIComponent(firstName)}&dates=${startDate}/${endDate}&details=${encodeURIComponent(description)}`;
    window.open(url, '_blank');
}

function downloadICS(customerName, deposit, remaining, bookingDate) {
    const firstName = customerName.split(' ')[0];
    const startDate = bookingDate.replace(/-/g, '') + 'T150000';
    const endDate = bookingDate.replace(/-/g, '') + 'T060000';
    const icsContent = `
BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:Ø­Ø¬Ø² ${firstName}
DESCRIPTION:Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†: ${deposit} Ø±ÙŠØ§Ù„\\nØ§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remaining} Ø±ÙŠØ§Ù„
DTSTART:${startDate}
DTEND:${endDate}
END:VEVENT
END:VCALENDAR
    `.trim();

    const blob = new Blob([icsContent], { type: 'text/calendar' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = customerName.trim().replace(/\s+/g, '_') + '.ics';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

form.addEventListener('submit', function(e){
    e.preventDefault();

    const customerName = document.getElementById('customerName').value;
    const deposit = document.getElementById('deposit').value;
    const remaining = document.getElementById('remaining').value;
    const bookingDate = document.getElementById('bookingDate').value;

    const dayName = getDayName(bookingDate);

    infoText.innerHTML = `
        <span class="booking-number">Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²: 117</span>
        <span class="bold">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±:</span> <span class="bold">${customerName}</span> <br>
        <strong>Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†:</strong> ${deposit} Ø±ÙŠØ§Ù„ <br>
        <span class="bold">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</span> <span class="bold">${remaining} Ø±ÙŠØ§Ù„</span> <br>
        <strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²:</strong> ${dayName} ${bookingDate} <br>
        <strong>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø­Ø¬Ø²:</strong> Ù…Ù† Ù£ Ù…Ø³Ø§Ø¡Ù‹ Ø¥Ù„Ù‰ Ù¦ ØµØ¨Ø§Ø­Ù‹Ø§
    `;

    contractFooter.innerHTML = `ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ù‚Ø¯: ${formatToday()}`;

    contract.style.display = 'block';
    window.scrollTo({ top: contract.offsetTop, behavior: 'smooth' });

    // Google Calendar
    calendarBtn.onclick = function() {
        addToGoogleCalendar(customerName, deposit, remaining, bookingDate);
    }

    // Ø­ÙØ¸ PDF
    printBtn.onclick = function() {
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù‚Ø¨Ù„ Ø­ÙØ¸ PDF
        printBtn.style.display = 'none';
        calendarBtn.style.display = 'none';
        calendarICSBtn.style.display = 'none';
        form.style.display = 'none';

        html2pdf().from(contract).set({
            margin: 10,
            filename: customerName.trim().replace(/\s+/g, '_') + '.pdf',
            html2canvas: { scale: 2, useCORS:true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        }).save().then(() => {
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©
            printBtn.style.display = 'block';
            calendarBtn.style.display = 'block';
            calendarICSBtn.style.display = 'block';
            form.style.display = 'block';
        });
    }

    // ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù .ics
    calendarICSBtn.onclick = function() {
        downloadICS(customerName, deposit, remaining, bookingDate);
    }
});
</script>

</body>
</html>
